!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.module=n():e.module=n()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},s=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),a=t(1),u=r(a);e.exports=function(){function e(){var n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i(this,e),this.events=[],this.peers={},n.dataChannel=n.channel||n.dataChannel,this.options=n}return s(e,[{key:"add",value:function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this.peers[e]||(this.peers[e]=new u["default"](o({offerer:null===t},this.options)),this.peers[e].on("signal",this.onSignal.bind(this,e)),this.peers[e].on("add-stream",this.onSignal.bind(this,e)),this.peers[e].on("channel-open",this.onOpen.bind(this,e)),this.peers[e].on("channel-message",this.onData.bind(this,e)),this.peers[e].on("channel-close",this.onClose.bind(this,e)),this.peers[e].on("channel-error",this.onError.bind(this,e)),this.peers[e].on("channel-buffered-amount-low",this.onBufferedAmountLow.bind(this,e)),this.peers[e].send=function(t){var r=n.peers[e].channel;r&&"open"===r.readyState&&r.send(t)}),t&&this.peers[e].addSignal(t)}},{key:"send",value:function(e,n){return e=JSON.stringify(e),void 0!==n?this.peers[n].send(e):void Object.keys(this.peers).forEach(function(n){this.peers[n].send(e)},this)}},{key:"onSignal",value:function(e,n){this.trigger("signal",[e,n])}},{key:"onOpen",value:function(e){this.trigger("connect",[e])}},{key:"onData",value:function(e,n){this.trigger("data",[e,JSON.parse(n.data)])}},{key:"onClose",value:function(e){delete this.peers[e],this.trigger("disconnect",[e])}},{key:"onError",value:function(){for(var e=arguments.length,n=Array(e),t=0;e>t;t++)n[t]=arguments[t];this.trigger("error",n)}},{key:"onBufferedAmountLow",value:function(){for(var e=arguments.length,n=Array(e),t=0;e>t;t++)n[t]=arguments[t];this.trigger("buffered-amount-low",n)}},{key:"on",value:function(e,n){this.events[e]=this.events[e]||[],this.events[e].push(n)}},{key:"off",value:function(e,n){if(this.events[e]=this.events[e]||[],n){var t=this.events[e].indexOf(n);return-1!==t&&this.events[e].splice(t,1),-1!==t}this.events[e]=[]}},{key:"trigger",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];this.events[e]=this.events[e]||[],this.events[e].forEach(function(e){e.apply(null,n)})}}]),e}()},function(e,n,t){!function(n,t){e.exports=t()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=function(e){var n="abcdefghijklmnopqrstuvwxyz";n+="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n+="0123456789";for(var t="",r=0;e>r;++r)t+=n[Math.floor((n.length-1)*Math.random())];return t},o=function(){return{RTCPeerConnection:window.RTCPeerConnection||window.msRTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCIceCandidate:window.RTCIceCandidate||window.msRTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate,RTCSessionDescription:window.RTCSessionDescription||window.msRTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription}},s=function(){function e(){var n=this,r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return t(this,e),r.options=r.options||{iceServers:[]},r.dataChannel&&"boolean"==typeof r.dataChannel&&(r.dataChannel={}),this.stream=r.stream,this.events={signal:[]},this.events["add-stream"]=[],this.events["channel-open"]=[],this.events["channel-message"]=[],this.events["channel-close"]=[],this.events["channel-error"]=[],this.events["channel-buffered-amount-low"]=[],this._signals=[],this.wrtc=r.wrtc||o(),this.wrtc.RTCPeerConnection?(this.peer=new this.wrtc.RTCPeerConnection(r.options),this.peer.onicecandidate=function(e){return e.candidate?n._onSignal(e.candidate):void 0},this.peer.ondatachannel=function(e){n.channel=e.channel,n._bindChannel()},this.peer.onaddstream=function(e){n.stream=e.stream,n.trigger("add-stream",[n.stream])},this.stream&&this.peer.addStream(r.stream),r.offerer?(r.dataChannel&&(this.channel=this.peer.createDataChannel(i(128),r.dataChannel),this._bindChannel()),void this.peer.createOffer(function(e){n.peer.setLocalDescription(e,function(){return n._onSignal(e)},n.onError)},this.onError)):void 0):console.error("No WebRTC support found")}return r(e,[{key:"_bindChannel",value:function(){["open","close","message","error","buffered-amount-low"].forEach(function(e){var n=this;this.channel["on"+e.replace(/-/g,"")]=function(){for(var t=arguments.length,r=Array(t),i=0;t>i;i++)r[i]=arguments[i];n.trigger("channel-"+e,[].concat(r))}},this)}},{key:"_onSignal",value:function(e){return 0===this.events.signal.length?this._signals.push(e):void this.trigger("signal",[e])}},{key:"addSignal",value:function(e){var n=this;return"offer"===e.type?this.peer.setRemoteDescription(new this.wrtc.RTCSessionDescription(e),function(){n.peer.createAnswer(function(e){n.peer.setLocalDescription(e,function(){n._onSignal(e)},n.onError)},n.onError)},this.onError):"answer"===e.type?this.peer.setRemoteDescription(new this.wrtc.RTCSessionDescription(e),function(){},this.onError):void this.peer.addIceCandidate(new this.wrtc.RTCIceCandidate(e),function(){},this.onError)}},{key:"on",value:function(e,n){return void 0===this.events[e]?console.error("MRTC: No such action '"+e+"'"):(this.events[e].push(n),void("signal"===e&&this._signals.forEach(function(e){this.trigger("signal",[e])},this)))}},{key:"off",value:function(e,n){if(n){var t=this.events[e].indexOf(n);return-1!==t&&this.events[e].splice(t,1),-1!==t}this.events[e]=[]}},{key:"trigger",value:function(e,n){n=n||[],this.events[e].forEach(function(e){e.apply(null,n)})}},{key:"onError",value:function(e){console.error(e)}}]),e}();n["default"]=s,e.exports=n["default"]}])})}])});